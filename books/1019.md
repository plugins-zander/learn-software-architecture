# 管道-过滤器风格

管道-过滤器风格

- 概述

  - 在管道-过滤器风格下，每个功能模块都有一组输入和输出
    - 功能模块称作过滤器（filters）
    - 功能模块间的连接可以看作输入、输出数据流之间的通路，所以称作管道（pipes）。
  - 管道-过滤器风格的特性之一在于过滤器的相对独立性，即过滤器独立完成自身功能，相互之间无需进行状态交互。

- 过滤器是独立运行的构件

  - 非临近的过滤器之间不共享状态

- 过滤器自身无状态

  - 过滤器对其处理上下连接的过滤器“无知”

- 对相邻的过滤器不施加任何限制

  - 结果的正确性不依赖于各个过滤器运行的先后次序
  - 各过滤器在输入具备后完成自己的计算。
  - 完整的计算过程包含在过滤器之间的拓扑结构中。

- 一个管道-过滤器风格的图示

  - 

    ![img](https://mubu.com/document_image/6c176f69-c84d-483d-8865-41d04964f654-4644403.jpg)

- 一个采用了嵌套的管道过滤器的系统示例

  - 

    ![img](https://mubu.com/document_image/4d3a118e-d598-48da-a821-6c6ae45ea63b-4644403.jpg)

- 实例

  - Unix系统中的管道过滤器结构
    - ls –al | grep my
  - DOS 中的管道命令
    - DOS允许在命令中出现用竖线字符“|”分开的多个命令，将符号“|”之前的命令的输出，作为“|”之后命令的输入，这就是“管道功能”，竖线字符“|”是管道操作符。
    - 例如
      - 命令dir | more使得当前目录列表在屏幕上逐屏显示。dir的输出是整个目录列表，它不出现在屏幕上而是由于符号“|”的规定，成为下一个命令more的输入，more命令则将其输入，more命令则将其输入一屏一屏地显示，成为命令行的输出。

- 优点

  - 设计者可以将整个系统的输入、输出特性简单的理解为各个过滤器功能的合成
    - 设计人员将整个系统的输入输出行为理解为单个过滤器行为的叠加与组合。
    - 这样可以将问题分解，化繁为简。
    - 将系统抽象成一个“黑箱”，其输入是系统中第一个过滤器的输入管道，输出是系统中最后一个过滤器的输出管道，而其内部各功能模块的具体实现对用户完全透明。
  - 支持功能模块的复用
    - 任何两个过滤器，只要它们之间传送的数据遵守共同的规约，就可以相连接。
    - 每个过滤器都有自己独立的输入输出接口，如果过滤器间传输的数据遵守其规约，只要用管道将它们连接就可以正常工作。
  - 系统具有较强的可维护性和可扩展性
    - 旧的过滤器可以被替代，新的过滤器可以添加到已有的系统上。
    - 软件的易于维护和升级是衡量软件系统质量的重要指标之一，在管道-过滤器模型中，只要遵守输入输出数据规约，任何一个过滤器都可以被另一个新的过滤器代替，同时为增强程序功能，可以添加新的过滤器。
    - 这样，系统的可维护性和可升级性得到了保证。
  - 支持一些特定的分析
    - 如吞吐量计算和死锁检测等
    - 利用管道-过滤器风格的视图，可以很容易的得到系统的资源使用和请求的状态图。
    - 然后，根据操作系统原理等相关理论中的死锁检测方法就可以分析出系统目前所处的状态，是否存在死锁可能及如何消除死锁等问题。
  - 具有并发性
    - 每个过滤器作为一个单独的执行任务，可以与其它过滤器并发执行。
    - 过滤器的执行是独立的，不依赖于其它过滤器的。在实际运行时，可以将存在并发可能的多个过滤器看作多个并发的任务并行执行，从而大大提高系统的整体效率，加快处理速度。

- 缺点

  - 交互式处理能力弱
    - 管道-过滤器模型适于数据流的处理和变换，不适合为与用户交互频繁的系统建模。
    - 在这种模型中，每个过滤器都有自己的数据，这些数据或者是从磁盘存储器中读取来，或者是由另一个过滤器的输出导入进来，整个系统没有一个共享的数据区。
    - 这样，当用户要操作某一项数据时，要涉及到多个过滤器对相应数据的操作，其实现较为复杂。由以上的缺点，可以对每个过滤器增加相应的用户控制接口，使得外部可以对过滤器的执行进行控制。
  - 导致系统处理过程的成批操作。
    - 设计者也许不得不花费精力协调两个相对独立但又存在某种关系的数据流之间的关系
      - 例如多过滤器并发执行时数据流之间的同步问题等。
    - 根据实际设计的需要，设计者也需要对数据传输进行特定的处理（如为了防止数据泄漏而采取加密等手段），导致过滤器必须对输入、输出管道中的数据流进行解析或反解析，增加了过滤器具体实现的复杂性。

- 实例——数字通信系统

  - 

    ![img](https://mubu.com/document_image/975035cf-c5ad-4742-ac4d-2344d64a33d3-4644403.jpg)

    ![img](https://mubu.com/document_image/6c3ef9ef-15b6-4821-8a84-4f7921124fc9-4644403.jpg)

    ![img](https://mubu.com/document_image/0571a5e8-1419-4bc6-a20e-a2ceadba0c94-4644403.jpg)

    ![img](https://mubu.com/document_image/ebb325ef-72bb-4872-9632-97ed4e426cfb-4644403.jpg)

    ![img](https://mubu.com/document_image/0c80db24-3ca1-482f-9e4a-dd555e9a4802-4644403.jpg)