# ATAM体系结构权衡分析方法

ATAM方法可看做SAAM方法的增强版。从名字可以看出，ATAM方法除了能暴露被评估体系结构的潜在缺陷和风险外，还能使我们更好地理解和权衡多个相关的，甚至是不一致的质量需求或目标。ATAM的基础来自3个领域：体系结构风格、质量属性分析组(包含丰富的质量属性和体系结构对应关系的库)和SAAM。

ATAM在各个发展阶段的大概步骤:

- ## 最初的ATAM

  大多数设计都是对目标进行权衡。如果不需要权衡，那么实际上也没必要做设计，因为只要根据需求做些固定的计算就行了。大多数的权衡源自非技术的原因。比如说，为了保证系统的可伸缩性，可能需要更多的间接层，从而导致更多的编程和测试工作，也意味着整个项目需要更多的花费，可能也需要更多的时间。再比如，两个涉众持有截然相反的需求，结果开发进程受阻。

  - 架构师的职责是进行设计，方式是采集需求并把需求映射到软件的结构和行为描述中去。

  - 不过除此之外，他们更重要的责任是从技术和社会学的视角做权衡。

  - ATAM就是做此类权衡的合适工具。

  - ATAM和其他评估方法或技术有着根本的不同，它明确考虑多个质量属性之间的关联，并可以对这些关联必然导致的权衡进行原则上的推理。

  - 为了达到这个目标，最初的ATAM分成4个阶段内的6个步骤，如图所示。

    

    ![img](https://mubu.com/document_image/f2d5b6e4-fed2-43c2-94f8-6d13ec6d6b9b-4644403.jpg)

  - 螺旋模型源自Boehm(1986)，该文引入了一个描述软件开发的类似的螺旋模型。图7-3把评估集成到了整个设计过程中。

  - 6个步骤，即收集场景，收集需求、限制和环境，描述体系结构视图，属性特定分析，识别敏感度和识别权衡，构成了一轮迭代。

  - 完成上述步骤后如果评估结果表明当前体系结构能满足期望的质量需求，就可以进行详细设计或实现了。

  - 否则，可以制定修改计划更新已有设计，新的设计将进入第二轮ATAM的迭代。

  - 值得注意的是，这些步骤并不需要按照线性顺序操作。

  - 每个步骤都可能会触发任何其他步骤的改进，正如图7-3所示。又如，属性特定分析可能需要收集更多的场景来保持各个属性的均衡。

  - 在进行一次迭代时，第一阶段关注场景输入。第一步仅仅关注“使用场景”，尽量增进参与者对体系结构的理解。这样沟通的基础就建立了。第二步是收集质量相关信息，也是以场景的形式表达。这些场景可以被看做是质量需求假设，是后续步骤的基础。得到需求之后，就可以利用需求的限制开始第一阶段的设计。设计出来的体系结构被编档以备评估。

  - 接下来评估就开始了。首先独立分析每个质量属性，这时候不必考虑场景关联。单独评估可以使得各个质量属性方面的专家最大程度地利用属性特定的技术或模型进行分析。比如，马尔科夫模型擅长可用性分析，而SPE(即软件性能工程)分析性能特别方便。属性特定分析的结果以特定模型中数据的测量值来表述，例如“最坏情况下请求必须在500 ms内得到响应”，或者“在理想环境下系统的可用性为99.99%”。

  - 最后要做的是识别敏感度和权衡。在解释这两个步骤之前，先定义一下“体系结构元素”。体系结构元素是指任何构件、构件属性或构件关系的属性，只要它们对质量属性有影响。敏感点是指会由于体系结构元素的修改而发生显著变化的系统模型参数。例如，基于C/S的系统，服务器的冗余度影响整个系统的可用性。增加一个后备服务器会把平均每年的系统崩溃时间降低一个数量级。这里系统平均崩溃时间就是一个敏感点。一个权衡点是指与多个敏感点有关的体系结构元素。 

  - 就是说，如果一个构件、构件属性或关系属性变化了，若干质量属性会大幅度地变得更好或更坏。 例如，C/S系统中服务器冗余度就是一个权衡点，因为它的改动将导致可用性、费用、安全性等属性的显著变化，这些特性有些是互相冲突的。权衡点揭示了架构师需要密切关注的问题。

- ## 改进版ATAM

  1999年，ATAM在几个实际项目中应用后，有了升级和增强。ATAM的原有步骤有的进行了合并，另外又补充了几个其他的步骤(如图所示)。比如，增加了“场景分组和设置优先级”，这个步骤和SAAM中类似。有几个步骤被浓缩成一个，如“体系结构介绍”。

  

  ![img](https://mubu.com/document_image/bdf70acf-7bec-4f10-85ad-bc48f4540cca-4644403.jpg)

  - 对改进版ATAM主要有两点值得注意。第一点是怎样才知道什么时候停止场景生成比较合适。从图7-4可以看到第3步进行场景覆盖检查。CMU SEI专门为此步骤定义了一套针对特定质量属性的问题，回答这些问题可以帮助评估者找到遗漏的有用场景并补充进来。
  - 另外一点就是引入了很多ABAS(基于属性的体系结构风格)。ABAS是一种分析辅助工具，可以帮助涉众识别体系结构风格的质量属性，比如性能、可用性、安全性、可测试性、可修改性等。
    - 简言之，ABAS就是带有属性值以反映质量信息的体系结构风格。
    - ABAS的著名例子是用于多个并发进程的性能分析。
    - 如果软件系统使用多个进程，每个进程都竞争有限的计算资源，该系统就可以称做性能ABAS。
    - 对此ABAS应当进行以下相关参数信息的质询，比如进程优先级、同步位置、排队策略和估计执行时间。
    - 但是，仅仅知道性能相关的信息并不足够，还需要把这些信息输入到分析框架以便分析。
    - 例如，单调速率分析是实时系统的一个有效分析框架。
  - 对比两个版本的ATAM，可以看到一个趋势，就是更多实际的技术和关注点被加入进来。
    - 第一版建立在螺旋开发模型之上，理论的味道很浓。在第二版，步骤进行了重新调整以更好地符合实际需要。
    - 除此之外，也引入了一些需要的辅助技术，尽管其中有些从评估的角度看并不能算是核心技术。 
  - 简单地说，这些变化试图为如下问题提供答案
    - 怎样帮助涉众知道做什么和怎么做从而为评估过程做贡献？
    - 怎样引导涉众精确清晰地理解待评估的体系结构？
    - 怎样生成对评估有益的场景，同时避免忽略某些必需的场景，并从所有场景中选出最重要的？
    - 怎么把场景映射到体系结构，以便识别敏感点和权衡点？
    - 最后，怎样对特定的质量属性进行具体的评估并生成负责规划后续活动的评估报告？
    - 这些问题是大多数评估方法的共同问题。
    - 尽管经历了众多项目的实际应用和数以千计的架构师、设计人员和软件工程师的改进，ATAM仍在不断调整以追求更好的评估效果

- ## ATAM的一般过程

  - 当前ATAM的完整过程包括4个阶段，共9个主要步骤。

    - 在此，步骤仍然不必是线性执行的。实践上，评估负责人可以决定应该执行哪些步骤，或者直接跳到本应在若干步之后才实施的步骤。这些都视情况而定。步骤仅仅表明评估中间制品的生成顺序。顺序靠后的步骤总需要靠前步骤的制品作为输入。因此，如果评估团队已经有了某一步骤生成的信息，或者这些信息对此次评估没有用处，就可以跳过这一步。

  - ATAM的一般过程如图所示。阶段Ⅰ和Ⅱ是评估的核心。

    

    ![img](https://mubu.com/document_image/0fd11991-67d9-4b63-aee1-28b19927ce16-4644403.jpg)

  - 阶段0是准备阶段

    - 考虑到ATAM评估的范围、时间和费用，有必要就评估时间表、费用计划、参与者组织等问题进行讨论甚至签署严格的合同协定。
    - 评估前首先应该搞清楚进行评估是否可行、谁参与评估、评估的对象是什么、评估结果提交给谁、评估后又该做什么。
    - 为了避免核心评估阶段中断，上面提到的每个问题都需要仔细考虑和计划。
    - 然后，需要建立一个评估团队(如果准备评估的组织没有专职评估团队的话)，负责接下来的工作。
    - 该团队中需要定义几个角色，包括团队领导、评估领导、书记员、计时者、提问者、监督员等。
    - 同一个人可以扮演多个角色。通常，在阶段0会开一个评估团队会议以明确责任并为下一阶段做好准备。

  - 阶段Ⅲ是评估收尾阶段。

    - 这时有两项任务必须要做。
    - 首先是要产生最终报告，记录核心评估阶段的过程、信息和基于此的结论。另一项任务是进行总结以便改进今后的评估。
    - 一方面，可以询问评估成员或者其他参与者感觉哪些活动好，哪些不好，为什么。可以收集关于本次评估的花费和收益的信息。这种数据挖掘可能会有利于找到各种活动的可改进之处。
    - 另一方面，可以整理本次的场景和相关的问题，以备下次评估类似项目。在领域特定的开发中，这项活动因其强大的可重用性而非常有效。

  - 阶段Ⅰ和阶段Ⅱ是核心评估阶段

    - 共有9个步骤，和前面小节曾讲的步骤类似。

    - 这些步骤又进一步分为如下4个子阶段

      - 介绍

        - (1) 介绍ATAM：介绍ATAM的步骤、活动和技术
        - (2) 介绍商业动机：介绍商业目标以识别主要质量需求。
        - (3) 介绍体系结构：解释当前体系结构如何满足商业动机。

      - 研究和分析

        - (4) 识别体系结构方法：找到建立体系结构所用的方法。
        - (5) 生成质量属性效用树：以树的形式产生反映系统效用的带有优先级的场景。
        - (6) 分析体系结构方法：对支持关键场景的体系结构方法进行分析，并识别风险、非风险、敏感点和权衡点。

      - 测试

        - (7) 头脑风暴和给场景指定优先级：由更多的涉众生成更多的场景。
        - (8) 分析体系结构方法：同步骤(6)，不过采用的场景来自步骤(7)。

      - 报告

        - (9) 报告结果：产生评估报告。

        - 实际上，主要阶段Ⅰ和Ⅱ分别是上述步骤的一次迭代，当然包括的具体步骤和参与者范围有所不同，如表所示。

          ![img](https://mubu.com/document_image/7237fcbf-7409-4d8c-be54-5f07c00a3f60-4644403.jpg)

        - 主要阶段Ⅱ需要更多类型的涉众参与场景生成和分析讨论。

        - 主要阶段Ⅰ则试图利用几个原则识别主要的质量属性，为后续评估打好基础。

        - 主要阶段Ⅰ只包含步骤(1)～(6)。

        - 当然，不必机械式地执行这两次迭代。

        - 实际应用时评估团队可以调整迭代这些步骤的时间计划，并可以自行决定每次迭代的参与者。

      - 读者可能会看到一些不熟悉的概念，如“效用树”、“风险”或者“非风险”，也可能会问为什么步骤(6)看上去和步骤(8)一样。这些问题在后面的小节中将有详细介绍。

- ## 介绍

  - 这个子阶段的目标是界定哪些行动是有益的，而哪些不是。该阶段引导参与者致力于系统设计并能做出贡献。同时，后续步骤所需的输入也由此阶段提供。
  - 步骤(1)——介绍ATAM
    - 这一步回答了“什么是ATAM？”和“ATAM参与者都做些什么？”的问题。
    - 这是因为除了专业的评估团队，其他涉众可能是第一次参与评估。
    - 评估负责人需要向参与者介绍ATAM，回答他们的相关问题。
    - 在此过程中，评估负责人的工作集中在场景确定优先级、效用树构建等操作的步骤、概念和技术，评估的输入输出及其他有关信息。
  - 步骤(2)——介绍商业动机
    - 项目领导人(项目主要管理者或类似人员)需要向所有参与者解释主要的商业动机。
    - 毕竟，场景开发和特定的评估需要此类信息。
    - 这项介绍的主题应该包括：主要商业目标，需求说明中已文档化的主要功能，来自技术、管理、经济、政策方面的有关限制，还有涉众的重要质量需求。
    - 注意“涉众”这个概念，在不同主要阶段，涉众的范围不同，这就使得关注点会有所偏重。这种差异也能作为一个参照，以便暴露那些没被考虑的问题。
  - 步骤(3)——介绍体系结构
    - 首席架构师介绍已有的体系结构，通常采用多视图的形式。
    - 大多数项目需要展示静态逻辑结构的分解视图、运行时结构的构件-连接件视图、逻辑结构和物理实体之间映射的分布视图和描述期望行为的行为视图。
    - 不过特定情况下，架构师有权决定使用其他视图展示系统某个特定区域，以此提供与关键质量属性对应的体系结构信息。 
    - 体系结构介绍的详细程度直接影响后续的分析。
    - 根据在准备阶段设定的评估的期望效果，架构师有义务选择一个对评估比较合适的详细程度。
    - 当然在评估时，如果需要的体系结构信息未被提供，涉众可以向架构师询问。
    - 最后，一个重要任务就是列出明确使用的体系结构方法，为下一步做准备。

- ## 研究和分析

  - 在这个子阶段，涉众开始将体系结构与质量属性对应起来。

  - 不过和前述ATAM的其他版本相比，在此使用的具体方法更加出色。

  - 这里捕获分析的不是体系结构元素，而是体系结构方法；用于场景生成的不是头脑风暴一类的办法，而是采用效用树。

  - 在效用树中，每个场景的优先级由二维估计值来测量。

  - 评估中，要识别风险、非风险、敏感点和权衡点，不过这些识别是分析的开始而非结束。

  - 步骤(4)——识别体系结构方法

    - 识别体系结构方法的原因是这些信息提供了体系结构构建背后的基本原则。
      - 简言之，一个体系结构方法是指根据功能或质量需求而做的设计决定。
    - 众所周知，软件体系结构风格和模式包含了大量的有用信息，这些信息与进行特定设计的原理紧密相关。
      - 体系结构模式描述了必要的抽象元素、这些元素的结构和相关的一些约束。
      - 每个体系结构模式的优缺点和基本原理都有成千上万次的使用作基础。
      - ATAM第二版中提到的ABAS尤其有用。
      - 和ABAS相联系的属性值暴露了主要的质量属性目标，也能用来分析能否满足这些目标。
    - 但是并不是所有的体系结构方法都可以用体系结构风格或模式的形式表达。
      - 如果是这样，架构师就需要用自然语言解释为什么做出这样的设计，或为什么设计会以期望的方式运行。
      - 架构师应该能讲清楚使用的每个体系结构方法。
      - 这样，对于那些架构师觉得很基础，但是对评估非常重要的体系结构方法(于是如果不是被明确的问到，架构师不会做特别说明)，其他评估参与者也有机会理解。
    - 尽管这一步骤需要清晰的解释，但是不需要对方法的分析，那是步骤(6)中的任务。

  - 步骤(5)——生成质量属性效用树

    - 本步骤将识别关键质量属性目标，参与者是评估团队和核心项目成员，如管理者、客户代表和首席架构师。

      - 这里主要的目标是避免在评估上时间和费用的浪费。
      - 如果参与者不能决定出关键的质量属性目标或就此达成一致，评估就无法得到应有的效果。
      - 质量属性效用树是达到此目标的强大工具。

    - 质量属性效用树(Quality Attribute Utility Tree，QAUT)以树的形式表现质量属性的细化。

      - QAUT的根是效用，接下来是质量属性层，典型的有可用性、可修改型和安全性等。

      - 再接着下一层是质量属性具体描述分类，也就是把某个质量属性分成几个主题。

      - 第四层也是最后一层，是具体的场景，精确定义了质量需求以允许后续分析。

      - 一般来说，QAUT把系统的期望效用翻译成了场景。

        - 每个场景有两维度量
          - (1) 此场景对系统成功的重要程度
          - (2) 架构师所估计的支持此场景的开发难度。
            - 测量所用的标度可以定为类似高、中、低这样范围为3的序数尺度，范围为5或者10等也可以。
            - 标记好度量后，场景就可以排出优先级了，最上面的是参与者希望得到的最关键的质量属性目标。

        ![img](https://mubu.com/document_image/f0a54b8d-05b9-4009-aadd-20588c8f033c-4644403.jpg)

        <center>QAUT的一个例子</center>

        - 实际上，真实项目中生成的场景比此例复杂得多。最终QUAT生成了带有优先级的场景列表，顺序应该是(H，H)、(H，M)、(M，H)……(L，L)。这个优先级清楚地揭示了各种涉众的全面关注。
        - 也许有人认为性能是关键需求，而另一些人坚持可用性需要更多的关注。
        - 但是在建立QAUT之前，每个人的想法可能都是凌乱的。
        - QAUT引导并澄清系统的质量需求及其相对重要性。
        - 于是，评估的时间和成本不够时就可以省略优先级低的场景。
        - 因为分析不重要或者很简单的场景没什么意义。

  - 步骤(6)——分析体系结构方法

    - QAUT指明了评估的方向，之后就该分析体系结构方法处理高优先级场景的机制了。
    - 在这一步骤，评估团队和架构师一道识别在那些和重要场景相关的方法中存在的风险、非风险、敏感点和权衡点。
    - 风险是已经做出的但是在特定的可能情况下出现潜在问题的决策。
      - 而非风险正好相反。可能有人会说风险应该受到更多关注，因为它们是将来的问题之源。
      - 不过，非风险也一样重要，因为它们暗示了哪些体系结构方法值得保留和坚持。
      - 更重要的是，当上下文变化的时候，非风险可能会转变成风险。因此，显式地列出非风险是有用的。
    - 敏感点是指会被某些体系结构元素显著影响的系统模型的属性值。
      - 权衡点是系统内与几个敏感点都相关的地方。
      - 在步骤(4)和步骤(5)中这些需要的信息应该就准备好了。
      - 不过若评估团队感到有什么信息缺失，可以询问架构师。
    - 为了识别风险、非风险、敏感点和权衡点，全体参与者都要完成下述工作：
    - 这一步骤结束，主要阶段Ⅰ就完成了。如果一切顺利，评估团队应该对体系结构有了大致的了解，也清楚了其优缺点。
      - (1) 识别出试图支持重要场景的体系结构方法并弄清楚这些方法在当前体系结构中是怎么实例化的。
      - (2) 分析每个方法，考虑其明显的优点和缺点，判断其是否对质量属性带来负面影响。这项工作可以利用询问一系列附属于这种体系结构方法的特定问题来完成。
      - (3) 在回答这些问题的基础上，识别风险、非风险、敏感点和权衡点并分别记录在文档中。  

- ## 测试

  - 这一阶段的目的是对到目前为止所作的分析进行测试。
  - 会有更多种类的涉众就系统质量需求给出建议。
  - 讨论的范围被扩大了，因而会有额外的问题和关注点出现来对系统需求进行补充。
  - 步骤(7)——头脑风暴和设定场景优先级
    - 在步骤(5)中，场景表示为QAUT，表明项目决策者心目中的体系结构该是什么样子。不过在这一步，评估团队的范围更大了。
    - 这里得到更多场景的有效方法是头脑风暴，就像SAAM的场景生成采用的方式。这种环境容易激发创造性的想法和新颖的建议。
    - 按性质场景可以分为以下3类：
    - (1) 用例场景
      - 描述被评估体系结构所在的系统在最终用户的特定操作下如何动作和响应。
    - (2) 增长式场景
      - 描述被评估体系结构所在的系统怎样支持快速修改和演化的，比如添加构件、平台移植或者与其他系统集成。
    - (3) 探索式场景
      - 探索被评估体系结构所在系统的极端增长情况。
      - 如果说增长式场景试图揭示期望中的和可能的修改，那么探索式场景使评估参与者有机会知道重大变更后系统会发生什么。
      - 比如说，性能必须提高5倍，或可用性需要提高一个数量级。
      - 根据这类场景，额外的敏感点和权衡点将会暴露，评估测试可基于此。
    - 头脑风暴后，利用投票为场景设置优先级，这和SAAM类似。
      - 显然步骤(5)和本步骤生成的场景有显著差异。利用QAUT生成场景是细化的过程，看起来是自顶向下的风格。
      - 评估团队和核心项目决策人通过QAUT找到当前体系结构的主要质量驱动。
      - 而头脑风暴生成的场景需要几乎所有涉众的合作。测试时，本步骤生成的场景将和QAUT的结果比对。
      - 新的场景成为QAUT已有分支的叶子节点，也可能原来就完全没有相应的质量属性分支。
      - 评估测试的目的也正是如此，即暴露二者之间的差异，补充未考虑到的场景。
  - 步骤(8)——分析体系结构方法
    - 这一步使用的方法和技术同步骤(6)，主要差别在于，在此涉众分析的是步骤(7)产生的体系结构方法。
    - 如果一切顺利，那么架构师只需要解释是如何用那些被捕获的方法来实现场景的。
    - 但是如果存在某些场景不能被直接支持，那么评估团队应该记录在档以便制定修改计划。

- ## 报告

  - 步骤(9)——提供评估结果
    - 这是ATAM一轮迭代的最后一步，包括已收集在原始体系结构文档内的、涉众生成的和分析得到的所有信息都要体现在评估报告中。
    - 最重要的内容或者说ATAM的输出，包括文档化的体系结构方法(包括这些方法附属的问题)、带优先级的场景、QAUT、关键质量需求、风险、非风险、敏感点和权衡点。
    - 所有涉众一起讨论来解决当前体系结构的问题，尤其是风险和权衡点。